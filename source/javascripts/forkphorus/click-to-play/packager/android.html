<!DOCTYPE html>
<html>

<head>
  <meta charset="utf8">
  <title>Forkphorus & Android - Guide</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 720px;
      margin: auto;
      line-height: 1.3;
    }
    table, tr, td, th {
      border-collapse: collapse;
      border: 1px solid black;
    }
    img {
      display: block;
    }
  </style>
</head>

<body>

  <h1>Forkphorus & Android</h1>
  <p>This is a guide to packaging Scratch projects as Android apps using Forkphorus.</p>

  <p>There's two ways to do this:
    <ul>
      <li>Embed a link to the packager on the homepage</li>
      <li>Embed a file generated by the HTML packager</li>
    </ul>
  </p>

  <p>We will discuss each of these separately.</p>

  <p><i>I have not personally tried to upload the result of any of these steps to the Google Play store yet, but there's no reason they shouldn't work.</i></p>

  <hr>

  <h2>First Method - Embedding a link</h2>

  <p>This is the easiest method. Forkphorus bug fixes and performance improvements will automatically (as well as new bugs) be applied and changes to your project will also apply automatically. The main issue is that this requires an internet connection to redownload your project, but it will probably work good enough for most people.</p>

  <ol>
    <li>Load your project in <a href="/">the Forkphorus homepage</a></li>
    <li>Scroll down to <i>Package this project</i></li>
    <li>If you want to enable Turbo Mode, check the <i>Turbo Mode</i> checkbox</li>
    <li>Setting the resolution to "Full screen" will allow the project to use as much screen space as possible. If this is not what you want, choose another option.</li>
    <li>Click the <i>Package</i> button and save the URL of the window opened somewhere -- we will need it in the next steps.</li>
  </ol>

  <p>At this point you just need to find a way to embed that URL into an app. I am currently aware of two ways to do this:
  </p>

  <h3>Using AppInventor</h3>

  <p>Perhaps using AppInventor just to embed a webpage is a bit overkill, but it works more than good enough. What we do in these steps won't require any programming knowledge or anything -- just follow what the steps say. AppInventor gives you a bit more flexibility as to how your app functions if you so desire.</p>

  <ol>
    <li>Go to <a href="http://appinventor.mit.edu/">the AppInventor home page</a> and hit <i>Create Apps!</i>. Sign in with a Google account.</li>
    <li>Hit <i>Start new project</i>, name the project (this doesn't matter), and hit <i>OK</i></li>
    <li>From the Palette on the left, drag a <i>WebViewer</i> into the Viewer in the middle of the screen.</li>
    <li>In the components menu, select <i>WebViewer1</i> and configure it like so:
      <table>
        <tr>
          <td>Width</td>
          <td>Fill parent...</td>
        </tr>
        <tr>
          <td>Height</td>
          <td>Fill parent...</td>
        </tr>
        <tr>
          <td>HomeURL</td>
          <td>The URL generated by Forkphorus (<i>https://forkphorus.github.io/app.html?...</i>)</td>
        </tr>
      </table>
      <img src="https://user-images.githubusercontent.com/17209175/65193625-5547a980-da41-11e9-821e-abbec5512601.png" height="464">
    </li>
    <li>In the components menu, select <i>Screen1</i> and consider the following optional settings:
      <table>
        <tr>
          <td>AppName</td>
          <td>The name of your app (eg. <i>Paper Minecraft</i>)</td>
        </tr>
        <tr>
          <td>TitleVisible</td>
          <td>false (unchecked) to remove an ugly titlebar from your app</td>
        </tr>
        <tr>
          <td>ShowStatusBar</td>
          <td>false (unchecked) to hide the native Android status bar while your app is running</td>
        </tr>
        <tr>
          <td>ScreenOrientation</td>
          <td>Landscape or Portrait if you want to force a specific screen orientation, otherwise leave this to its default value.</td>
        </tr>
        <tr>
          <td>Icon</td>
          <td>A nice icon for your project.</td>
        </tr>
      </table>
      <img src="https://user-images.githubusercontent.com/17209175/65193665-858f4800-da41-11e9-8f3c-7c644ada52ce.png" height="1265">These are all optional. There are some other options you can set but many of them will have no effect.
    </li>
    <li>To create an APK:
      <ul>
        <li>Select <i>Build</i> &gt; <i>App (provide QR code for .APK)</i> and scan the QR code on your phone</li>
        <li>or Select <i>Build</i> &gt; <i>App (save .apk to my computer)</i></li>
      </ul>
    </li>
    <li>Publish that to the Google Play Store, or whatever you wanted to do with it.</li>
  </ol>

  <h3>Using AppsGeyser</h3>

  <ol>
    <li>Open the AppsGeyser page <a href="http://appsgeyser.com/create-url-app/"><i>Create Smart URL App</i></a></li>
    <li>Insert the link Forkphorus generated into the <i>Website URL</i> box.</li>
    <li>Choose a color theme, and hit <i>NEXT</i></li>
    <li>Fill out details such as your App's Name, Description, and Icon, and then hit <i>Create</i></li>
    <li>From here, navigate the treacherous interface to Publish or Download your APK. This will probably cost money.</li>
  </ol>

  <hr>

  <h2>Second Method - Using the HTML packager</h2>
  <p><i>There are some known issues with this method for now -- I will try to get those fixed soon.</i></p>
  <p>An alternative method involves creating an independent HTML file for your project and embedding that. The main advantage is that this will work offline, independent of an internet connection and will always produce the same result.</p>
  <p>Generate an HTML file using <a href="/packager/">the HTML packager</a>. The only important part of this step is that you must make sure that "Include CSP" is enabled under "Advanced Options". (it is enabled by default)</p>
  <p>Keep project.html around, we will need it in the next steps.</p>
  <p>We will use PhoneGap to embed this HTML file into an Android app.</p>

  <ol>
    <li>Note that <i>we actually won't need to install PhoneGap.</i> We will be using their online build service.</li>
    <li>We need to generate a ZIP archive that contains project.html (but renamed to index.html). The easiest way to do that is to put it into this file selector: <input type="file" id="pg-input" accept=".html"></li>
    <li>Go to the <a href="https://build.phonegap.com">PhoneGap build service</a> and sign in with or create an Adobe account</li>
    <li>Create a new <i>Private</i> app and upload the generated ZIP to the service.</li>
    <li>Wait for the builds to complete.</li>
    <li>Click on the Android icon to download the APK.</li>
  </ol>

  <p><small>If you use the PhoneGap CLI/Desktop app you will find that Forkphorus is broken in the preview. This is a PhoneGap bug -- you can ignore it because it will work in the final build.</small></p>

  <script src="../lib/jszip.min.js"></script>
  <script>
    document.getElementById('pg-input').addEventListener('input', function(e) {
      function err(m) { alert(m); throw new Error(m); }
      var f = e.target.files[0];
      if (!f) err('no file!');
      var fr = new FileReader();
      fr.onload = function() {
        var buffer = fr.result;
        var zip = new JSZip();
        zip.file('index.html', buffer);
        zip.generateAsync({type: 'blob', compression: 'DEFLATE'})
          .then(function(blob) {
            var url = URL.createObjectURL(blob);
            var download = document.createElement('a');
            download.href = url;
            download.download = f.name.substring(0, f.name.length - 5) + '.zip';
            document.body.appendChild(download);
            download.click();
          })
          .catch(function(err) {
            err('cannot zip');
          });
      };
      fr.onerror = function() {
        err('cannot read');
      };
      fr.readAsArrayBuffer(f);
    });
  </script>

  <hr>

  <p>If you encounter problems or wish to improve this guide, please post something on <a href="https://github.com/forkphorus/forkphorus/issues">GitHub</a>.</p>

</body>

</html>